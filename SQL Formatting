import os
import re

def format_sql_file(file_path):
    with open(file_path, 'r') as file:
        sql_lines = file.readlines()

    formatted_lines = []
    
    for line in sql_lines:
        # Remove extra whitespace
        line = re.sub(r'\s+', ' ', line).strip()
        
        # Remove double semicolons and ensure a single semicolon at the end
        line = line.replace(';;', ';')
        if line.strip().endswith(');'):
            line = line.rstrip(');') + ');\n'  # Ensure there's only one semicolon before the closing parenthesis
            
        # Format INSERT statements
        if line.startswith("INSERT INTO"):
            parts = line.split('VALUES')
            if len(parts) > 1:
                values_part = parts[1].strip()
                cleaned_values = values_part.replace('(( ', '(').replace(' (', '(')
                
                value_list = cleaned_values.split(',')
                cleaned_values = []

                for value in value_list:
                    value = value.strip()
                    if value.isdigit():
                        cleaned_values.append(value)
                    else:
                        cleaned_values.append(f"'{value}'")
                
                cleaned_values_part = ', '.join(cleaned_values)
                formatted_line = f"{parts[0]} VALUES ({cleaned_values_part});\n"
                formatted_lines.append(formatted_line)
            else:
                formatted_lines.append(line)
        else:
            formatted_lines.append(line)

    # Write the formatted lines back to the file
    with open(file_path, 'w') as file:
        file.writelines(formatted_lines)

def format_sql_files_in_folder(folder_path):
    for filename in os.listdir(folder_path):
        if filename.endswith('.sql'):
            file_path = os.path.join(folder_path, filename)
            format_sql_file(file_path)
            print(f"Formatted: {filename}")

# Specify the absolute folder path containing SQL files
folder_path = '/Users/azizkhan/GitVersions/SQL/'  # Update with the correct absolute path
format_sql_files_in_folder(folder_path)
